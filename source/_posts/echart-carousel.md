---
title: Echarts 画个球🌍复杂的那种
date: 2018-08-16 10:58:23
tags: 假使要我跟你再耗个十年
---
我经常吐槽Echarts烂，讲真一点都不冤枉是真的烂：文档差劲，没有答疑群，issues常年不解答。
发微博咨询有没有客服答疑群，自动回复说去[stackoverflow](https://stackoverflow.com/) 问然后就没有人回应了。真是自信，以为你的影响力到国际了？
最主要那个网红当年面试当时部门技术不过关被刷了，真人也不好看，听闻去了这个团队。所以对这个Echarts一点好感也没有。

所以把画的复杂的图列分享出来，包括踩过的坑，也许可以帮助跟我一样都！是！苦！衷！的同学。

{% img /images/blog/2018/0816-2.png %}(数据保密相关只能截取部分图)

需求：地球上标注物理机房的位置，动态飞线来标注两两之间的数据传输示意；同时定时切换机房高亮当前值来展示更多详细信息。同时保障性能。

DEMO戳[这里](http://gallery.echartsjs.com/editor.html?c=xB1qQB3zUm&v=4)



__遇到的问题__

1. `baseTexture`地球纹理等贴图的图片不支持跨域：

{% img /images/blog/2018/0816-3.png %}

尽管 CDN 图片是支持跨域的，但传递到 Canvas里，只要域名不同就认为跨域，贴图失败。显然 Echarts 还没有解决办法，它的文档里写了的几种类型全都试过，没用...

{% img /images/blog/2018/0816-1.png %}

解决办法：把图片放到本地项目里加载；或者使用`nginx`把某个`url`指向 CDN 上的这张图片，保证域名前缀相同

2. Echarts版本需要固定，否则在某些版本下也是会报错。目前是
```json
"echarts": "4.0.4",
"echarts-for-react": "2.0.2",
"echarts-gl": "1.1.0",
```
（我看echarts 4.1.0 也是可以

3. 地球坐标系中不支持`effectScatter`，所以我非常 Hack 地使用了两个 Echarts DOM，让当前点的 DOM 图层居中，和地球旋转到中间的位置刚好重叠。所以如果你的地球圆心不在绝对居中的位置，这个`effectScatter`的点位置也要做相应的改变。

4. 性能相关：
    - 空白的 Canvas 也会消耗性能贴图，所以画布和画像的大小尽量贴合。比如`effectScatter`图层就点的大小就可以了（比如68px）
    - 飞线的速度，高亮点的涟漪速度，和定时轮询的速度也影响性能。在可接受范围下的最慢。

